{#
 # Metadata
 # --------
 #
 # Includes standard, Open Graph and Twitter metadata tags. Finds whatever settings to generate them.
 #}

{% set metaKeywords    = entry.metaKeywords | default(metadata.metaKeywords) %}
{% set metaDescription = entry.metaDescription | default(metadata.metaDescription) %}
{% set metaTitle       = entry.metaTitle | default(entry.title) | default(pageTitle) | default(siteName) %}
{% set metaUrl         = url() %}
{% set metaImages      = (entry.image.find() | default([]))
	| merge(entry.galleryImages.find() | default([]))
	| merge(entry.metaImages.find() | default([]))
%}
{% set metaImage       = metaImages.first() %}
{% set metaVideos      = [] %}
{% set metaAudio       = false %}
{% set metaVideos      = [] %}
{% set metaVideo       = false %}
{% set metaAuthors     = [] %}
{% set metaLocale      = craft.locale %}
{% set metaTwitter     = entry.metaTwitter | default(metadata.metaTwitter) %}
{% set metaPublished   = entry.postDate | default(entry.dateCreated) %}
{% set metaModified    = entry.dateUpdated %}
{% set metaExpires     = entry.expiryDate %}
{% set metaTags        = entry.tags %}
{% set metaRobots      = metaExpires ? ['unavailable_after:' ~ metaExpires.rfc850()] : [] %}
{% set metaSection     = metaType.metaSection | default(entry.parent.title) | default(entry.getSection().name) %}
{% set metaType        = 'website' %}
{% if metaPublished and metaTags %}
	{% set metaType = 'article' %}
{% endif %}
{% for param in entry.metaRobots %}
	{% set metaRobots = metaRobots | merge([param]) %}
{% endfor %}


{#
 # Standard
 #}

{% if metaRobots      %}<meta name="robots" content="{{ metaRobots | join(',') }}">{% endif %}
{% if metaKeywords    %}<meta name="keywords" content="{{ metaKeywords }}">{%         endif %}
{% if metaDescription %}<meta name="description" content="{{ metaDescription }}">{%   endif %}


{#
 # Open Graph (ogp.me)
 #}

{% if metaType        %}<meta property="og:type" content="{{ metaType }}">{%               endif %}
{% if metaTitle       %}<meta property="og:title" content="{{ metaTitle }}">{%             endif %}
{% if metaUrl         %}<meta property="og:url" content="{{ metaUrl }}">{%                 endif %}
{% if siteName        %}<meta property="og:site_name" content="{{ siteName }}">{%          endif %}
{% if metaDescription %}<meta property="og:description" content="{{ metaDescription }}">{% endif %}
{% for audio in metaAudios %}
	<meta property="og:audio" content="{{ audio.getUrl }}">
	<meta property="og:audio:type" content="{{ audio.mimeType }}">
{% endfor %}
{% for video in metaVideos %}
	<meta property="og:video" content="{{ video.getUrl }}">
	<meta property="og:video:width" content="{{ video.width }}">
	<meta property="og:video:height" content="{{ video.height }}">
	<meta property="og:video:type" content="{{ video.mimeType }}">
{% endfor %}
{% for image in metaImages %}
	<meta property="og:image" content="{{ image.getUrl }}">
	<meta property="og:image:width" content="{{ image.width }}">
	<meta property="og:image:height" content="{{ image.height }}">
	<meta property="og:image:type" content="{{ image.mimeType }}">
{% endfor %}

{% switch(metaType) %}

	{% case 'article' %}

		{% if metaSection   %}<meta property="og:article:section" content="{{ metaSection }}">{%                    endif %}
		{% if metaPublished %}<meta property="og:article:published_time" content="{{ metaPublished.iso8601() }}">{% endif %}
		{% if metaModified  %}<meta property="og:article:modified_time" content="{{ metaModified.iso8601() }}">{%   endif %}
		{% if metaExpires   %}<meta property="og:article:expiration_time" content="{{ metaExpires.iso8601() }}">{%  endif %}
		{% for author in metaAuthors %}
			<meta property="og:article:author" content="{{ author.getUrl }}">
		{% endfor %}
		{% for tag in metaTags %}
			<meta property="og:article:tag" content="{{ tag }}">
		{% endfor %}

	{# TODO
	 # profile, book, music.song, music.album, music.playlist, music.radiostation,
	 # video.movie, video.episode, video.tv_show, video.other
	 #}

{% endswitch %}


{#
 # Twitter (dev.twitter.com/cards)
 #}

{# TODO (perhaps add/merge this with meta type)
 # Gallery card
 # App card
 # Player card
 # Product card
 #}

{% if metaTwitter %}
	<meta property="twitter:card" content="{{ metaImage ? 'summary_large_image' : 'summary' }}">
	<meta property="twitter:site" content="{{ metaTwitter }}">
	{% if metaTitle       %}<meta property="twitter:title" content="{{ metaTitle }}">{%             endif %}
	{% if metaDescription %}<meta property="twitter:description" content="{{ metaDescription }}">{% endif %}
	{% if metaUrl         %}<meta property="twitter:url" content="{{ metaUrl }}">{%                 endif %}
	{% if metaImage       %}<meta property="twitter:image" content="{{ metaImage.getUrl }}">{%      endif %}
{% endif %}
